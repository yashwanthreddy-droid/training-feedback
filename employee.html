<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Training Feedback | HGS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<style>
body { background:#f4f6f9; font-family:Inter,sans-serif; margin:0; }
.container { max-width:820px; margin:40px auto; background:#fff; padding:36px; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,.08); }
.logo { display:flex; justify-content:center; margin-bottom:14px; }
.logo img { height:46px; }

h2 { text-align:center; color:#003a63; margin-bottom:6px; }
p.sub { text-align:center; color:#6b7280; font-size:13px; }

label { display:block; margin-top:18px; font-weight:700; font-size:13px; }
input, select, textarea { width:100%; padding:12px; border-radius:10px; border:1px solid #cfd8e3; margin-top:6px; box-sizing:border-box; }
textarea { min-height:90px; resize:vertical; }

.rating-block { margin-top:22px; }
.rating-title { display:flex; justify-content:space-between; font-weight:700; }
.rating-buttons { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }
.rating-buttons button { width:44px; height:44px; border-radius:50%; border:2px solid #cfd8e3; background:#f7f9fc; font-weight:800; cursor:pointer; }
.rating-buttons button.selected { background:#005bab; color:#fff; border-color:#005bab; }

.submit-btn { margin-top:32px; width:100%; padding:16px; border-radius:14px; background:#005bab; color:#fff; font-size:16px; font-weight:800; border:none; cursor:pointer; }
.submit-btn:disabled { background:#9bbad1; cursor:not-allowed; }

.success { display:none; margin-top:18px; background:#e8f7ee; color:#0a6b38; padding:14px; border-radius:12px; font-weight:800; text-align:center; }
.errorBox { display:none; margin-top:12px; background:#fdecec; color:#b42318; padding:12px; border-radius:12px; font-weight:800; font-size:13px; }
.small { font-size:12px; color:#6b7280; margin-top:6px; }
</style>
</head>

<body>
<div class="container">

<div class="logo"><img src="hgs-logo.png" alt="HGS Logo"></div>
<h2>Training Feedback Form</h2>
<p class="sub">Please share your honest feedback to help us improve learning experiences.</p>

<label>Training Topic *</label>
<input id="trainingTopic">

<label>Training Date *</label>
<input id="trainingDate" placeholder="Select training date">
<div class="small">Allowed range: last 60 days only (no future dates).</div>

<label>Location *</label>
<select id="location">
  <option value="">Select</option>
  <option>OIC</option>
  <option>BSEL</option>
  <option>SV & PK</option>
  <option>IRIS</option>
  <option>Bangalore</option>
  <option>Virtual</option>
</select>

<label>Employee Code *</label>
<div style="display:flex;gap:10px;">
  <select id="empPrefix">
    <option value="">Select</option>
    <option>BS</option>
    <option>HGSI</option>
  </select>
  <input id="employeeCode" placeholder="12345">
</div>

<label>Department *</label>
<input id="department">

<!-- Ratings -->
<div class="rating-block" data-field="overallRating">
  <div class="rating-title">Overall Session Rating <span id="overallRatingVal">—</span></div>
  <div class="rating-buttons">
    <button type="button" data-v="1">1</button><button type="button" data-v="2">2</button>
    <button type="button" data-v="3">3</button><button type="button" data-v="4">4</button>
    <button type="button" data-v="5">5</button>
  </div>
</div>

<div class="rating-block" data-field="contentRelevanceRating">
  <div class="rating-title">Content relevance to your work <span id="contentRelevanceRatingVal">—</span></div>
  <div class="rating-buttons">
    <button type="button" data-v="1">1</button><button type="button" data-v="2">2</button>
    <button type="button" data-v="3">3</button><button type="button" data-v="4">4</button>
    <button type="button" data-v="5">5</button>
  </div>
</div>

<div class="rating-block" data-field="trainerDeliveryRating">
  <div class="rating-title">Trainer clarity & delivery <span id="trainerDeliveryRatingVal">—</span></div>
  <div class="rating-buttons">
    <button type="button" data-v="1">1</button><button type="button" data-v="2">2</button>
    <button type="button" data-v="3">3</button><button type="button" data-v="4">4</button>
    <button type="button" data-v="5">5</button>
  </div>
</div>

<div class="rating-block" data-field="sessionPaceRating">
  <div class="rating-title">Session pace <span id="sessionPaceRatingVal">—</span></div>
  <div class="rating-buttons">
    <button type="button" data-v="1">1</button><button type="button" data-v="2">2</button>
    <button type="button" data-v="3">3</button><button type="button" data-v="4">4</button>
    <button type="button" data-v="5">5</button>
  </div>
</div>

<div class="rating-block" data-field="usefulnessRating">
  <div class="rating-title">Usefulness for your current role <span id="usefulnessRatingVal">—</span></div>
  <div class="rating-buttons">
    <button type="button" data-v="1">1</button><button type="button" data-v="2">2</button>
    <button type="button" data-v="3">3</button><button type="button" data-v="4">4</button>
    <button type="button" data-v="5">5</button>
  </div>
</div>

<label>Recommendation Score (NPS) (0–10) *</label>
<input type="number" id="npsScore" min="0" max="10">

<label>What did you like most about the session? *</label>
<textarea id="likedMost"></textarea>

<label>What could be improved? *</label>
<textarea id="toImprove"></textarea>

<!-- ✅ Suggestions question added -->
<label>Any other suggestions or topics you’d like us to cover next?</label>
<textarea id="suggestions" placeholder="Optional"></textarea>

<button class="submit-btn" id="submitBtn" disabled>Submit Feedback</button>
<div class="errorBox" id="errorBox"></div>
<div class="success" id="success">Thank you! Your feedback has been recorded.</div>

</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxfaK3udVG9WBAUz-L4HqgLAj_QRnkhyeicqg688iUAH5xMq58pvtjuJryYtNzSEaE5xQ/exec'; // keep your /exec URL

const ratings = {
  overallRating: null,
  contentRelevanceRating: null,
  trainerDeliveryRating: null,
  sessionPaceRating: null,
  usefulnessRating: null
};

const $ = (id) => document.getElementById(id);

flatpickr("#trainingDate", {
  maxDate: "today",
  minDate: new Date().fp_incr(-60),
  allowInput: false
});

// rating clicks
document.querySelectorAll('.rating-block').forEach(block => {
  const field = block.dataset.field;
  block.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      ratings[field] = Number(btn.dataset.v);

      block.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');

      const valEl = $(field + 'Val');
      if (valEl) valEl.textContent = btn.dataset.v;

      validate();
    });
  });
});

function validate(){
  const ok =
    $('trainingTopic').value.trim() &&
    $('trainingDate').value.trim() &&
    $('location').value.trim() &&
    $('empPrefix').value.trim() &&
    $('employeeCode').value.trim() &&
    $('department').value.trim() &&
    Object.values(ratings).every(v => v !== null) &&
    $('npsScore').value !== '' &&
    Number($('npsScore').value) >= 0 &&
    Number($('npsScore').value) <= 10 &&
    $('likedMost').value.trim() &&
    $('toImprove').value.trim();

  $('submitBtn').disabled = !ok;
}

document.querySelectorAll('input,select,textarea').forEach(el=>{
  el.addEventListener('input', validate);
  el.addEventListener('change', validate);
});

$('submitBtn').addEventListener('click', async () => {
  $('errorBox').style.display = 'none';
  $('success').style.display = 'none';

  $('submitBtn').disabled = true;
  const oldText = $('submitBtn').textContent;
  $('submitBtn').textContent = 'Submitting...';

  // ✅ FLAT payload keys (matches your sheet columns)
  const payload = {
    trainingTopic: $('trainingTopic').value.trim(),
    trainingDate: $('trainingDate').value.trim(),
    location: $('location').value.trim(),
    employeeCode: `${$('empPrefix').value.trim()}-${$('employeeCode').value.trim()}`,
    department: $('department').value.trim(),

    overallRating: ratings.overallRating,
    contentRelevanceRating: ratings.contentRelevanceRating,
    trainerDeliveryRating: ratings.trainerDeliveryRating,
    sessionPaceRating: ratings.sessionPaceRating,
    usefulnessRating: ratings.usefulnessRating,

    npsScore: Number($('npsScore').value),
    likedMost: $('likedMost').value.trim(),
    toImprove: $('toImprove').value.trim(),
    suggestions: $('suggestions').value.trim()
  };

  try {
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    let data = {};
    try { data = JSON.parse(text); } catch { data = { status:'unknown', raw:text }; }

    if (!res.ok || data.status !== 'ok') throw new Error(data.message || `Submit failed (HTTP ${res.status})`);

    $('success').style.display = 'block';
    $('submitBtn').textContent = 'Submitted';

    // ✅ refresh after 5 seconds
    setTimeout(() => window.location.reload(), 5000);

  } catch (err) {
    $('errorBox').textContent = err.message || 'Submission failed. Please try again.';
    $('errorBox').style.display = 'block';
    $('submitBtn').disabled = false;
    $('submitBtn').textContent = oldText;
  }
});

validate();
</script>

</body>
</html>


